<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Add Staff (by Photo URL)</title>
  <style>
    body{font-family:Arial;padding:20px}
    label{display:block;margin:8px 0}
    input[type="text"],input[type="email"],input[type="number"],input[type="date"],textarea{width:100%;padding:6px}
  </style>
</head>
<body>
  <h2>Add Staff (photo by URL)</h2>

  <form id="form">
    <label>Name <input name="name" required></label>
    <label>Phone 1 <input name="phone1" required></label>
    <label>Phone 2 <input name="phone2"></label>
    <label>Address <textarea name="address"></textarea></label>
    <label>Aadhaar Number <input name="adhaar"></label>
    <label>Salary <input name="salary" type="number" step="0.01"></label>

    <!-- replaced file input with text URL input -->
    <label>Photo URL <input name="photo_url" type="text" placeholder="https://example.com/photo.jpg"></label>

    <label>Parents Name <input name="parents_name"></label>
    <label>Post <input name="post"></label>
    <label>District <input name="district"></label>
    <label>Email <input name="email" type="email"></label>
    <label>Date of Birth <input name="dob" type="date"></label>
    <label>Spouse Name (if any) <input name="spouse_name"></label>
    <label>Work Location <input name="work_location"></label>
    <label>Department <input name="department"></label>
    <label>Joining Date <input name="joining_date" type="date"></label>

    <div style="margin-top:12px">
      <button type="submit">Save Staff</button>
      <a href="index.html" style="margin-left:12px">Back</a>
    </div>
  </form>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // <<< REPLACE these with your project values >>>
    const SUPABASE_URL = "https://bclxscvpjkewftbeeqjd.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJjbHhzY3Zwamtld2Z0YmVlcWpkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4ODAyMDUsImV4cCI6MjA3OTQ1NjIwNX0.0kLf4dvMCtH467a-XqZlf6WP7KA9xBIeLGJ8TUBXodI";


    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // basic url check
    function isValidUrl(s) {
      if (!s) return false;
      try {
        const u = new URL(s);
        return u.protocol === 'http:' || u.protocol === 'https:';
      } catch (e) { return false; }
    }

    document.getElementById('form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const f = e.target;
      const btn = f.querySelector('button[type="submit"]');
      btn.disabled = true; btn.innerText = 'Saving...';

      try {
        const photoUrlInput = (f.photo_url.value || '').trim();
        if (photoUrlInput && !isValidUrl(photoUrlInput)) {
          alert('Photo URL is not a valid http/https URL.');
          btn.disabled = false; btn.innerText = 'Save Staff';
          return;
        }

        const payload = {
          name: f.name.value.trim(),
          phone1: f.phone1.value.trim(),
          phone2: f.phone2.value.trim() || null,
          address: f.address.value.trim() || null,
          adhaar: f.adhaar.value.trim() || null,
          salary: f.salary.value ? parseFloat(f.salary.value) : null,
          photo_url: photoUrlInput || null,
          parents_name: f.parents_name.value.trim() || null,
          post: f.post.value.trim() || null,
          district: f.district.value.trim() || null,
          email: f.email.value.trim() || null,
          dob: f.dob.value || null,
          spouse_name: f.spouse_name.value.trim() || null,
          work_location: f.work_location.value.trim() || null,
          department: f.department.value.trim() || null,
          joining_date: f.joining_date.value || null
        };

        // debug log
        console.log('Inserting staff payload:', payload);

        const res = await supabase.from('staff').insert([payload]).select();
        console.log('Supabase insert response:', res);

        if (res.error) {
          // show full error for debugging
          console.error('Insert error details:', res.error);
          alert('Save error: ' + (res.error.message || JSON.stringify(res.error)));
        } else {
          alert('Staff saved âœ“');
          f.reset();
        }
      } catch (err) {
        console.error('Unexpected error:', err);
        alert('Unexpected error: ' + (err.message || err));
      } finally {
        btn.disabled = false; btn.innerText = 'Save Staff';
      }
    });
  </script>
</body>
</html>
