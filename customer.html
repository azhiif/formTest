<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Add Customer</title>
  <style>body{font-family:Arial;padding:20px}label{display:block;margin:8px 0}input,select{width:100%;padding:6px}</style>
</head>
<body>
  <h2>Add Customer</h2>

  <form id="form">
    <label>Name <input name="name" required></label>
    <label>Designation <input name="designation"></label>
    <label>Consulted by
      <select name="consulted_by" id="consulted_by"><option value="">-- none --</option></select>
    </label>
    <label>Phone <input name="phone"></label>
    <label>Place <input name="place"></label>
    <label>Purpose <input name="purpose"></label>

    <div style="margin-top:12px">
      <button type="submit">Save</button>
      <a href="index.html" style="margin-left:12px">Back</a>
    </div>
  </form>

  <script src="supabase-config.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function loadStaffs(){
      try {
        const { data, error } = await supabase.from('staff').select('id,name,post').order('name');
        if (error) { console.error('loadStaffs error', error); return; }
        const sel = document.getElementById('consulted_by');
        data.forEach(s => {
          const opt = document.createElement('option');
          opt.value = s.id;
          opt.textContent = s.name + (s.post ? (' — ' + s.post) : '');
          sel.appendChild(opt);
        });
      } catch (e) { console.error(e); }
    }

    document.getElementById('form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const f = e.target;
      const payload = {
        name: f.name.value.trim(),
        designation: f.designation.value.trim() || null,
        consulted_by: f.consulted_by.value ? Number(f.consulted_by.value) : null,
        phone: f.phone.value.trim() || null,
        place: f.place.value.trim() || null,
        purpose: f.purpose.value.trim() || null
      };

      const { data, error } = await supabase.from('customers').insert([payload]).select();
      if (error) {
        alert('Error: ' + error.message);
        console.error(error);
      } else {
        alert('Saved ✓');
        f.reset();
      }
    });

    loadStaffs();
  </script>
</body>
</html>
